<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="QCute"><title>Windows系统代理脚本 ｜ 轻作</title>
<meta name=description content='Windows 10下设置系统代理老是要打开设置 -> 网络 -> 代理
于是写了个脚本来设置和开启/关闭代理
@echo off chcp 65001>nul SetLocal :: status for /f %%i in (&#39;PowerShell -NoLogo -NonInteractive -NoProfile -Command "$(Get-ItemProperty -Path \"HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\" -Name \"ProxyEnable\").ProxyEnable"&#39;) do ( set status=%%i ) :: server for /f %%i in (&#39;PowerShell -NoLogo -NonInteractive -NoProfile -Command "$(Get-ItemProperty -Path \"HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\" -Name \"ProxyServer\").ProxyServer"&#39;) do ( set server=%%i ) :: toggle if "%1" == "" goto toggle :proxy PowerShell -NoLogo -NonInteractive -NoProfile -Command "Write-Host &#39;Found proxy address &#39; -NoNewLine ; Write-Host -Fore Cyan &#39;%server%&#39; -NoNewLine ; Write-Host &#39; from argument, &#39; -NoNewLine ; Write-Host -Fore Green &#39;enable&#39; -NoNewLine ; Write-Host &#39; system proxy...&#39;" reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyEnable /t REG_DWORD /d 1 /f >nul 2>nul reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyServer /d "%1" /f >nul 2>nul goto end :toggle if "%server%" == "" goto disable if "%status%" == "1" goto disable :enable PowerShell -NoLogo -NonInteractive -NoProfile -Command "Write-Host &#39;Found proxy address &#39; -NoNewLine ; Write-Host -Fore Blue &#39;%server%&#39; -NoNewLine ; Write-Host &#39; from registry, &#39; -NoNewLine ; Write-Host -Fore Green &#39;enable&#39; -NoNewLine ; Write-Host &#39; system proxy...&#39;" reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyEnable /t REG_DWORD /d 1 /f >nul 2>nul goto end :disable PowerShell -NoLogo -NonInteractive -NoProfile -Command "Write-Host &#39;Proxy &#39; -NoNewLine ; Write-Host -Fore Blue &#39;IP:PORT&#39; -NoNewLine ; Write-Host &#39; not set, &#39; -NoNewLine ; Write-Host -Fore Red &#39;disable&#39; -NoNewLine ; Write-Host &#39; system proxy...&#39;" reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyEnable /t REG_DWORD /d 0 /f >nul 2>nul goto end :end EndLocal 设置并开启代理 proxy.bat 127.0.0.1:1080 开启/关闭代理 proxy.bat 注册表参考
'><meta name=keywords content="Hugo,theme,graphite"><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=apple-touch-icon type=image/x-icon href=/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.0.1/remixicon.css><link rel=stylesheet type=text/css media=screen href=/css/highlight.min.css><link rel=stylesheet type=text/css media=screen href=/css/graphite.min.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/tags/>标签</a></li><li><a href=/posts/>归档</a></li><li><a href=/about/>关于</a></li><li><a href=/search/ title=搜索 id=site_search><i class=ri-search-line></i></a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://qcute.github.io/><span><img src=/images/favicon.ico></span></a></h1></div><div class=description><h1 style=float:right><a><span>轻作</span></a></h1><br><br><p class=sub_title>重拾写作的乐趣</p><div class=my_socials><a href=https://github.com/QCute title=github target=_blank><i class=ri-github-fill></i></a>
<a href=https://www.zhihu.com/people/tui-fei-er-you-ya-de-shen-shi title=zhihu target=_blank><i class=ri-zhihu-fill></i></a>
<a href type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/batch/proxy/>Windows系统代理脚本</a></h2><i class="icon ri-time-line"></i>
<span class=date>2020.03.03</span></div><div class="post_content markdown"><p>Windows 10下设置系统代理老是要打开设置 -> 网络 -> 代理<br>于是写了个脚本来设置和开启/关闭代理</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl>chcp 65001<span class=p>&gt;</span>nul
</span></span><span class=line><span class=cl><span class=k>SetLocal</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: status</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=k>/f</span> <span class=se>%%</span>i <span class=k>in</span> <span class=p>(</span><span class=s1>&#39;PowerShell -NoLogo -NonInteractive -NoProfile -Command &#34;$(Get-ItemProperty -Path \&#34;HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\&#34; -Name \&#34;ProxyEnable\&#34;).ProxyEnable&#34;&#39;</span><span class=p>)</span> <span class=k>do</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>set</span> <span class=nv>status</span><span class=p>=</span><span class=se>%%</span>i
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: server</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=k>/f</span> <span class=se>%%</span>i <span class=k>in</span> <span class=p>(</span><span class=s1>&#39;PowerShell -NoLogo -NonInteractive -NoProfile -Command &#34;$(Get-ItemProperty -Path \&#34;HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings\&#34; -Name \&#34;ProxyServer\&#34;).ProxyServer&#34;&#39;</span><span class=p>)</span> <span class=k>do</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>set</span> <span class=nv>server</span><span class=p>=</span><span class=se>%%</span>i
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=c1>: toggle</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=s2>&#34;</span><span class=nv>%1</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span> <span class=k>goto</span> <span class=nl>toggle</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=nl>proxy</span>
</span></span><span class=line><span class=cl>PowerShell -NoLogo -NonInteractive -NoProfile -Command <span class=s2>&#34;Write-Host &#39;Found proxy address &#39; -NoNewLine ; Write-Host -Fore Cyan &#39;</span><span class=nv>%server%</span><span class=s2>&#39; -NoNewLine ; Write-Host &#39; from argument, &#39; -NoNewLine ; Write-Host -Fore Green &#39;enable&#39; -NoNewLine ; Write-Host &#39; system proxy...&#39;&#34;</span>
</span></span><span class=line><span class=cl>reg add <span class=s2>&#34;HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings&#34;</span> /v ProxyEnable /t REG_DWORD /d 1 /f <span class=p>&gt;</span>nul <span class=mi>2</span><span class=p>&gt;</span>nul
</span></span><span class=line><span class=cl>reg add <span class=s2>&#34;HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings&#34;</span> /v ProxyServer /d <span class=s2>&#34;</span><span class=nv>%1</span><span class=s2>&#34;</span> /f <span class=p>&gt;</span>nul <span class=mi>2</span><span class=p>&gt;</span>nul
</span></span><span class=line><span class=cl><span class=k>goto</span> <span class=nl>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=nl>toggle</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=s2>&#34;</span><span class=nv>%server%</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span> <span class=k>goto</span> <span class=nl>disable</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=s2>&#34;</span><span class=nv>%status%</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;1&#34;</span> <span class=k>goto</span> <span class=nl>disable</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=nl>enable</span>
</span></span><span class=line><span class=cl>PowerShell -NoLogo -NonInteractive -NoProfile -Command <span class=s2>&#34;Write-Host &#39;Found proxy address &#39; -NoNewLine ; Write-Host -Fore Blue &#39;</span><span class=nv>%server%</span><span class=s2>&#39; -NoNewLine ; Write-Host &#39; from registry, &#39; -NoNewLine ; Write-Host -Fore Green &#39;enable&#39; -NoNewLine ; Write-Host &#39; system proxy...&#39;&#34;</span>
</span></span><span class=line><span class=cl>reg add <span class=s2>&#34;HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings&#34;</span> /v ProxyEnable /t REG_DWORD /d 1 /f <span class=p>&gt;</span>nul <span class=mi>2</span><span class=p>&gt;</span>nul
</span></span><span class=line><span class=cl><span class=k>goto</span> <span class=nl>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=nl>disable</span>
</span></span><span class=line><span class=cl>PowerShell -NoLogo -NonInteractive -NoProfile -Command <span class=s2>&#34;Write-Host &#39;Proxy &#39; -NoNewLine ; Write-Host -Fore Blue &#39;IP:PORT&#39; -NoNewLine ; Write-Host &#39; not set, &#39; -NoNewLine ; Write-Host -Fore Red &#39;disable&#39; -NoNewLine ; Write-Host &#39; system proxy...&#39;&#34;</span>
</span></span><span class=line><span class=cl>reg add <span class=s2>&#34;HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings&#34;</span> /v ProxyEnable /t REG_DWORD /d 0 /f <span class=p>&gt;</span>nul <span class=mi>2</span><span class=p>&gt;</span>nul
</span></span><span class=line><span class=cl><span class=k>goto</span> <span class=nl>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=nl>end</span>
</span></span><span class=line><span class=cl><span class=k>EndLocal</span>
</span></span></code></pre></div><ul><li>设置并开启代理</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl>proxy.bat 127.0.0.1:1080
</span></span></code></pre></div><ul><li>开启/关闭代理</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl>proxy.bat
</span></span></code></pre></div><p>注册表参考</p><blockquote><p>是否开启代理<br>HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ProxyEnable</p></blockquote><blockquote><p>代理地址<br>HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ProxyServer</p></blockquote></div><div class=post_footer></div></div><div class=doc_comments><div class=comments_block_title>发表评论</div><div id=comments></div></div><style>.giscus,.giscus-frame{margin-bottom:48px}</style><script src=https://giscus.app/client.js data-repo=QCute/qcute.github.io data-repo-id=R_kgDOG-5qXQ data-category=Announcements data-category-id=DIC_kwDOG-5qXc4CSRb_ data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=statistics><i class=ri-article-line></i>
<span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span>
</span><i class=ri-bar-chart-box-line></i>
<span id=busuanzi_container_site_pv><span id=busuanzi_value_site_pv></span></span></div><div class=footer_slogan><span>轻作 | 重拾写作的乐趣</span></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script><script src=/js/graphite.min.js></script><script src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script type=text/javascript id=MathJax-script async src=https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js></script><script>MathJax={options:{skipHtmlTags:["script","noscript","style","textarea","pre"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0}}</script></body></html>