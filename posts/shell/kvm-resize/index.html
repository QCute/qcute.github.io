<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="VarKai"><title>KVM调整磁盘大小 ｜ 轻作</title>
<meta name=description content="一、创建新空间并复制旧数据 1.创建一块大小100G的空硬盘 qemu-img create -f qcow2 new.qcow2 100G 2.使用virt-resize进行对要扩大的分区进行扩容 virt-resize --expand /dev/sda1 old.qcow2 new.qcow2 virt-resize 在 guestfs-tools 或者 libguestfs-tools 上 二、直接扩大磁盘的大小 qemu-img resize old.qcow2 +10G 三、完成后使用 qemu-img 和 virt-df"><meta name=keywords content="Hugo,theme,graphite"><link rel="shortcut icon" href=https://qcute.github.io/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/normalize.css@8.0.1/normalize.css><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/animate.css@4.1.1/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/remixicon@2.5.0/fonts/remixicon.css><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/@fancyapps/ui@4.0.27/dist/fancybox.css><link rel=stylesheet type=text/css media=screen href=/css/highlight.min.css><link rel=stylesheet type=text/css media=screen href=/css/graphite.min.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/tags/>标签</a></li><li><a href=/posts/>归档</a></li><li><a href=/about/>关于</a></li><li><a href=/search/ title=搜索 id=site_search><i class=ri-search-line></i></a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://qcute.github.io/><span><img src=https://gohugo.io/favicon.ico></span></a></h1></div><div class=description><h1 style=float:right><a><span>轻作</span></a></h1><br><br><p class=sub_title>重拾写作的乐趣</p><div class=my_socials><a href=https://github.com/QCute title=github target=_blank><i class=ri-github-fill></i></a>
<a href=https://www.zhihu.com/people/tui-fei-er-you-ya-de-shen-shi title=zhihu target=_blank><i class=ri-zhihu-fill></i></a>
<a href type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/shell/kvm-resize/>KVM调整磁盘大小</a></h2><span class=date>2020.03.10</span></div><div class="post_content markdown"><h1 id=一创建新空间并复制旧数据>一、创建新空间并复制旧数据</h1><ul><li>1.创建一块大小100G的空硬盘</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>qemu-img create -f qcow2 new.qcow2 100G
</span></span></code></pre></div><ul><li>2.使用virt-resize进行对要扩大的分区进行扩容</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>virt-resize --expand /dev/sda1 old.qcow2 new.qcow2
</span></span></code></pre></div><blockquote><p>virt-resize 在 guestfs-tools 或者 libguestfs-tools 上</p></blockquote><h1 id=二直接扩大磁盘的大小>二、直接扩大磁盘的大小</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>qemu-img resize old.qcow2 +10G
</span></span></code></pre></div><h1 id=三完成后使用-qemu-img-和-virt-df-查看镜像信息>三、完成后使用 qemu-img 和 virt-df 查看镜像信息</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ qemu-img info new.qcow2
</span></span><span class=line><span class=cl>image: new.qcow2
</span></span><span class=line><span class=cl>file format: qcow2
</span></span><span class=line><span class=cl>virtual size: <span class=m>32</span> GiB <span class=o>(</span><span class=m>34359738368</span> bytes<span class=o>)</span>
</span></span><span class=line><span class=cl>disk size: <span class=m>16</span> GiB
</span></span><span class=line><span class=cl>cluster_size: <span class=m>65536</span>
</span></span><span class=line><span class=cl>Format specific information:
</span></span><span class=line><span class=cl>    compat: 1.1
</span></span><span class=line><span class=cl>    compression type: zlib
</span></span><span class=line><span class=cl>    lazy refcounts: <span class=nb>true</span>
</span></span><span class=line><span class=cl>    refcount bits: <span class=m>16</span>
</span></span><span class=line><span class=cl>    corrupt: <span class=nb>false</span>
</span></span><span class=line><span class=cl>    extended l2: <span class=nb>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ virt-df new.qcow2
</span></span><span class=line><span class=cl>Filesystem                           1K-blocks       Used  Available  Use%
</span></span><span class=line><span class=cl>new.qcow2:/dev/sda1                    <span class=m>6054432</span>    <span class=m>5122484</span>     <span class=m>603452</span>   85%
</span></span><span class=line><span class=cl>new.qcow2:/dev/sda5                   <span class=m>10264092</span>     <span class=m>509272</span>    <span class=m>9211844</span>    5%
</span></span></code></pre></div></div><div class=post_footer></div></div><div class=doc_comments><div class=comments_block_title>发表评论</div><div id=comments></div></div><style>.giscus,.giscus-frame{margin-bottom:48px}</style><script src=https://giscus.app/client.js data-repo=QCute/qcute.github.io data-repo-id=R_kgDOG-5qXQ data-category=Announcements data-category-id=DIC_kwDOG-5qXc4CSRb_ data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>轻作、重拾写作的乐趣</span></div></footer><script src=https://unpkg.com/elevator.js@1.0.1/elevator.min.js></script><script src=https://unpkg.com/dom-slider@2.1.6/dist/dom-slider.js></script><script src=https://unpkg.com/@fancyapps/ui@4.0.27/dist/fancybox.umd.js></script><script src=/js/graphite.min.js></script><script>MathJax={options:{skipHtmlTags:["script","noscript","style","textarea","pre"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0}}</script><script type=text/javascript id=MathJax-script async src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script></body></html>