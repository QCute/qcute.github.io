<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="VarKai"><title>记一次bash的while循环中使用escript的问题 ｜ 轻作</title><meta name=description content="问题 在一次写脚本时，偶然发现了当Escript在Bash的while中使用时，循环里明明有很多次，但是Escript却只执行了一次的问题。 Escript执行脚本test.erl时，启动命令如下 test.erl -B -- -root"><meta name=keywords content="Hugo,theme,graphite"><link rel="shortcut icon" href=https://qcute.github.io/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/normalize.css@8.0.1/normalize.css><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/animate.css@4.1.1/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/remixicon@2.5.0/fonts/remixicon.css><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/@fancyapps/ui@4.0.27/dist/fancybox.css><link rel=stylesheet type=text/css media=screen href=https://qcute.github.io/css/highlight.css><link rel=stylesheet type=text/css media=screen href=https://qcute.github.io/css/graphite.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/tags/>标签</a></li><li><a href=/about/>关于</a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://qcute.github.io/><span><img src=https://gohugo.io/favicon.ico></span></a></h1></div><div class=description><h1 style=float:right><a><span>轻作</span></a></h1><br><br><p class=sub_title>重拾写作的乐趣</p><div class=my_socials><a href=https://github.com/QCute title=github target=_blank><i class=ri-github-fill></i></a>
<a href=https://www.zhihu.com/people/tui-fei-er-you-ya-de-shen-shi title=zhihu target=_blank><i class=ri-zhihu-fill></i></a>
<a href=https://qcute.github.io/index.xml type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/shell/while-escript/>记一次bash的while循环中使用escript的问题</a></h2><span class=date>2022.03.08</span></div><div class="post_content markdown"><h3 id=问题>问题</h3><p>在一次写脚本时，偶然发现了当<a href=https://www.erlang.org/doc/man/escript.html>Escript</a>在<a href=https://github.com/gitGNU/gnu_bash>Bash</a>的while中使用时，循环里明明有很多次，但是<a href=https://www.erlang.org/doc/man/escript.html>Escript</a>却只执行了一次的问题。</p><p><a href=https://www.erlang.org/doc/man/escript.html>Escript</a>执行脚本test.erl时，启动命令如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>test.erl -B -- -root /usr/lib/erlang -progname erl -- -home /home/m -- -boot no_dot_erlang -noshell -run escript start -extra test.erl
</span></span></code></pre></div><p>命令里有<a href=https://www.erlang.org/doc/man/erl.html#-noshell>-noshell</a>标识，此时erlang不会启动shell</p><p>原因就是在<a href=https://www.erlang.org/doc/man/escript.html>Escript</a>模式下，<a href=https://github.com/erlang/otp>Erlang</a>不会启动shell，但是仍然会从stdin中读取输入，而while读取下一次内容时就会向stdin输入内容，而内容则被<a href=https://github.com/erlang/otp>Erlang</a>读取了，循环也就“结束”了。</p><p>解决办法就是在命令行加上 &lt; /dev/null 使stdin重定向到null上，也就是禁用stdin</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>escript test.erl &lt; /dev/null
</span></span></code></pre></div><p>或者在脚本文件的shebang行上加上<a href=https://www.erlang.org/doc/man/erl.html#-noinput>-noinput</a>标识，来禁用输入</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-erl data-lang=erl><span class=line><span class=cl><span class=c>%%! -noinput
</span></span></span></code></pre></div><h3 id=思考>思考</h3><p>此问题类似于在while循环中使用ssh、scp或者sshpass等会使用到stdin的命令的时候，需要加上 &lt; /dev/null，不然循环只会执行一次。</p><h3 id=参考>参考</h3><ul><li><a href=https://www.erlang.org/doc/man/erl.html#-noshell>-noshell</a>标识</li></ul><blockquote><p>Ensures that the Erlang runtime system never tries to read any input. Implies -noshell.</p></blockquote><ul><li><a href=https://www.erlang.org/doc/man/erl.html#-noinput>-noinput</a>标识</li></ul><blockquote><p>Starts an Erlang runtime system with no shell. This flag makes it possible to have the Erlang runtime system as a component in a series of Unix pipes.</p></blockquote></div><div class=post_footer></div></div><div class=doc_comments></div></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>轻作、重拾写作的乐趣</span></div></footer><script src=https://unpkg.com/elevator.js@1.0.1/elevator.min.js></script>
<script src=https://unpkg.com/dom-slider@2.1.6/dist/dom-slider.js></script>
<script src=https://unpkg.com/@fancyapps/ui@4.0.27/dist/fancybox.umd.js></script>
<script src=https://qcute.github.io/js/graphite.js></script>
<script>MathJax={options:{skipHtmlTags:["script","noscript","style","textarea","pre"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0}}</script><script type=text/javascript id=MathJax-script async src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script></body></html>