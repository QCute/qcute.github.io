<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="QCute"><title>记录一次RockyLinux UEFI磁盘迁移(扩展) ｜ 轻作</title>
<meta name=description content=' 使用任意软件, 例如傲梅, 进行磁盘一比一直接克隆
从新硬盘启动系统, 出现卡住的情况, 一般是复制的时候EFI分区UUID更改了(生成新的)
A stop job is running for dev-disk-by\x2duuid-6C02\x2dB99B.device 等待一会后, 键入root密码, 进入紧急模式 使用blkid查看块UUID, /dev/sda1正是EFI分区 /dev/sda1: SEC_TYPE="msdos" UUID="0000-4823" BLOCK_SIZE="512" TYPE="vfat" PARTLABEL="EFI system partition" PARTUUID="182ddd5c-fc1b-11ee-bc5d-c3b5b8bd8720" /dev/sda2: UUID="fa5133df-3efe-40d8-8386-2599e0bc6417" BLOCK_SIZE="512" TYPE="xfs" PARTUUID="182ddd60-fc1b-11ee-bc5d-c3b5b8bd8720" /dev/sda3: UUID="LCzkNd-2bJU-hk6q-YIeS-RBnM-XY0f-u91TAG" TYPE="LVM2_member" PARTUUID="182ddd64-fc1b-11ee-bc5d-c3b5b8bd8720" /dev/mapper/rl-root: UUID="0e5e4a9c-cbb1-40b4-ac83-7a5021b10e31" BLOCK_SIZE="512" TYPE="xfs" /dev/mapper/rl-swap: UUID="717d74bc-390f-47b5-83ed-e9322bbcbbe3" TYPE="swap" /dev/mapper/rl-home: UUID="013f7c16-aaa4-4346-b9c8-4bb02cc456cd" BLOCK_SIZE="512" TYPE="xfs" 修改/etc/fstab上/boot/efi的UUID, 重启即可 # # /etc/fstab # Created by anaconda on Thu Apr 7 07:46:10 2022 # # Accessible filesystems, by reference, are maintained under &#39;/dev/disk/&#39;. # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info. # # After editing this file, run &#39;systemctl daemon-reload&#39; to update systemd # units generated from this file. # /dev/mapper/rl-root / xfs defaults 0 0 UUID=fa5133df-3efe-40d8-8386-2599e0bc6417 /boot xfs defaults 0 0 UUID=0000-4823 /boot/efi vfat umask=0077,shortname=winnt 0 2 /dev/mapper/rl-home /home xfs defaults 0 0 /dev/mapper/rl-swap none swap defaults 0 0 调整磁盘大小 parted /dev/sda 对LVM分区进行扩容 resizepart 3 100% 对分区物理卷进行扩容 pvresize /dev/sda3 使用pvs查看卷 PV VG Fmt Attr PSize PFree /dev/sda3 rl lvm2 a-- 929.92g 0 使用vgdisplay查看卷组情况 --- Volume group --- VG Name rl System ID Format lvm2 Metadata Areas 1 Metadata Sequence No 7 VG Access read/write VG Status resizable MAX LV 0 Cur LV 3 Open LV 3 Max PV 0 Cur PV 1 Act PV 1 VG Size 929.92 GiB PE Size 4.00 MiB Total PE 238060 Alloc PE / Size 28211 / <110.20 GiB Free PE / Size 209849 / 819.72 GiB VG UUID rFnljf-9GxD-tS5t-8b6e-esEc-E2Jc-Lg2tpC 扩展root卷大小 lvextend -l +100%FREE /dev/mapper/rl-root 同步root卷文件系统 xfs_growfs /dev/mapper/rl-root 使用df -h查看磁盘情况 Filesystem Size Used Avail Use% Mounted on devtmpfs 16G 0 16G 0% /dev tmpfs 16G 13M 16G 1% /dev/shm tmpfs 16G 26M 16G 1% /run tmpfs 16G 0 16G 0% /sys/fs/cgroup /dev/mapper/rl-root 913G 64G 849G 7% / /dev/sda2 1014M 251M 764M 25% /boot /dev/sda1 600M 6.0M 594M 1% /boot/efi /dev/mapper/rl-home 9.6G 746M 8.9G 8% /home tmpfs 3.2G 32K 3.2G 1% /run/user/1000 '><meta name=keywords content="Hugo,theme,graphite"><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=apple-touch-icon type=image/x-icon href=/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.0.1/remixicon.css><link rel=stylesheet type=text/css media=screen href=/css/highlight.min.css><link rel=stylesheet type=text/css media=screen href=/css/graphite.min.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/tags/>标签</a></li><li><a href=/posts/>归档</a></li><li><a href=/about/>关于</a></li><li><a href=/search/ title=搜索 id=site_search><i class=ri-search-line></i></a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://qcute.github.io/><span><img src=/images/favicon.ico></span></a></h1></div><div class=description><h1 style=float:right><a><span>轻作</span></a></h1><br><br><p class=sub_title>重拾写作的乐趣</p><div class=my_socials><a href=https://github.com/QCute title=github target=_blank><i class=ri-github-fill></i></a>
<a href=https://www.zhihu.com/people/tui-fei-er-you-ya-de-shen-shi title=zhihu target=_blank><i class=ri-zhihu-fill></i></a>
<a href type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/shell/disk-copy/>记录一次RockyLinux UEFI磁盘迁移(扩展)</a></h2><i class="icon ri-time-line"></i>
<span class=date>2020.03.10</span></div><div class="post_content markdown"><ol><li><p>使用任意软件, 例如<a href=https://www.disktool.cn/>傲梅</a>, 进行磁盘一比一直接克隆</p></li><li><p>从新硬盘启动系统, 出现卡住的情况, 一般是复制的时候EFI分区UUID更改了(生成新的)</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>A stop job is running <span class=k>for</span> dev-disk-by<span class=se>\x</span>2duuid-6C02<span class=se>\x</span>2dB99B.device
</span></span></code></pre></div><ol start=3><li>等待一会后, 键入root密码, 进入紧急模式</li></ol><ul><li>使用<a href>blkid</a>查看块UUID, <a href>/dev/sda1</a>正是EFI分区</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>/dev/sda1: <span class=nv>SEC_TYPE</span><span class=o>=</span><span class=s2>&#34;msdos&#34;</span> <span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;0000-4823&#34;</span> <span class=nv>BLOCK_SIZE</span><span class=o>=</span><span class=s2>&#34;512&#34;</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;vfat&#34;</span> <span class=nv>PARTLABEL</span><span class=o>=</span><span class=s2>&#34;EFI system partition&#34;</span> <span class=nv>PARTUUID</span><span class=o>=</span><span class=s2>&#34;182ddd5c-fc1b-11ee-bc5d-c3b5b8bd8720&#34;</span>
</span></span><span class=line><span class=cl>/dev/sda2: <span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;fa5133df-3efe-40d8-8386-2599e0bc6417&#34;</span> <span class=nv>BLOCK_SIZE</span><span class=o>=</span><span class=s2>&#34;512&#34;</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;xfs&#34;</span> <span class=nv>PARTUUID</span><span class=o>=</span><span class=s2>&#34;182ddd60-fc1b-11ee-bc5d-c3b5b8bd8720&#34;</span>
</span></span><span class=line><span class=cl>/dev/sda3: <span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;LCzkNd-2bJU-hk6q-YIeS-RBnM-XY0f-u91TAG&#34;</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;LVM2_member&#34;</span> <span class=nv>PARTUUID</span><span class=o>=</span><span class=s2>&#34;182ddd64-fc1b-11ee-bc5d-c3b5b8bd8720&#34;</span>
</span></span><span class=line><span class=cl>/dev/mapper/rl-root: <span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;0e5e4a9c-cbb1-40b4-ac83-7a5021b10e31&#34;</span> <span class=nv>BLOCK_SIZE</span><span class=o>=</span><span class=s2>&#34;512&#34;</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;xfs&#34;</span>
</span></span><span class=line><span class=cl>/dev/mapper/rl-swap: <span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;717d74bc-390f-47b5-83ed-e9322bbcbbe3&#34;</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;swap&#34;</span>
</span></span><span class=line><span class=cl>/dev/mapper/rl-home: <span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;013f7c16-aaa4-4346-b9c8-4bb02cc456cd&#34;</span> <span class=nv>BLOCK_SIZE</span><span class=o>=</span><span class=s2>&#34;512&#34;</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>&#34;xfs&#34;</span>
</span></span></code></pre></div><ul><li>修改<a href>/etc/fstab</a>上<a href>/boot/efi</a>的UUID, 重启即可</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># /etc/fstab</span>
</span></span><span class=line><span class=cl><span class=c1># Created by anaconda on Thu Apr  7 07:46:10 2022</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Accessible filesystems, by reference, are maintained under &#39;/dev/disk/&#39;.</span>
</span></span><span class=line><span class=cl><span class=c1># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># After editing this file, run &#39;systemctl daemon-reload&#39; to update systemd</span>
</span></span><span class=line><span class=cl><span class=c1># units generated from this file.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>/dev/mapper/rl-root     /                       xfs     defaults        <span class=m>0</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=nv>UUID</span><span class=o>=</span>fa5133df-3efe-40d8-8386-2599e0bc6417 /boot                   xfs     defaults        <span class=m>0</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=nv>UUID</span><span class=o>=</span>0000-4823          /boot/efi               vfat    <span class=nv>umask</span><span class=o>=</span>0077,shortname<span class=o>=</span>winnt <span class=m>0</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>/dev/mapper/rl-home     /home                   xfs     defaults        <span class=m>0</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>/dev/mapper/rl-swap     none                    swap    defaults        <span class=m>0</span> <span class=m>0</span>
</span></span></code></pre></div><ol start=4><li>调整磁盘大小</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>parted /dev/sda
</span></span></code></pre></div><ol start=5><li>对LVM分区进行扩容</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>resizepart <span class=m>3</span> 100%
</span></span></code></pre></div><ol start=6><li>对分区物理卷进行扩容</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pvresize /dev/sda3
</span></span></code></pre></div><ol start=5><li>使用<a href>pvs</a>查看卷</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>  PV         VG Fmt  Attr PSize   PFree
</span></span><span class=line><span class=cl>  /dev/sda3  rl lvm2 a--  929.92g    <span class=m>0</span>
</span></span></code></pre></div><ol start=6><li>使用<a href>vgdisplay</a>查看卷组情况</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>  --- Volume group ---
</span></span><span class=line><span class=cl>  VG Name               rl
</span></span><span class=line><span class=cl>  System ID
</span></span><span class=line><span class=cl>  Format                lvm2
</span></span><span class=line><span class=cl>  Metadata Areas        <span class=m>1</span>
</span></span><span class=line><span class=cl>  Metadata Sequence No  <span class=m>7</span>
</span></span><span class=line><span class=cl>  VG Access             read/write
</span></span><span class=line><span class=cl>  VG Status             resizable
</span></span><span class=line><span class=cl>  MAX LV                <span class=m>0</span>
</span></span><span class=line><span class=cl>  Cur LV                <span class=m>3</span>
</span></span><span class=line><span class=cl>  Open LV               <span class=m>3</span>
</span></span><span class=line><span class=cl>  Max PV                <span class=m>0</span>
</span></span><span class=line><span class=cl>  Cur PV                <span class=m>1</span>
</span></span><span class=line><span class=cl>  Act PV                <span class=m>1</span>
</span></span><span class=line><span class=cl>  VG Size               929.92 GiB
</span></span><span class=line><span class=cl>  PE Size               4.00 MiB
</span></span><span class=line><span class=cl>  Total PE              <span class=m>238060</span>
</span></span><span class=line><span class=cl>  Alloc PE / Size       <span class=m>28211</span> / &lt;110.20 GiB
</span></span><span class=line><span class=cl>  Free  PE / Size       <span class=m>209849</span> / 819.72 GiB
</span></span><span class=line><span class=cl>  VG UUID               rFnljf-9GxD-tS5t-8b6e-esEc-E2Jc-Lg2tpC
</span></span></code></pre></div><ol start=7><li>扩展<a href>root</a>卷大小</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>lvextend -l +100%FREE /dev/mapper/rl-root
</span></span></code></pre></div><ol start=8><li>同步<a href>root</a>卷文件系统</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>xfs_growfs /dev/mapper/rl-root
</span></span></code></pre></div><ol start=9><li>使用<a href>df -h</a>查看磁盘情况</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>Filesystem           Size  Used Avail Use% Mounted on
</span></span><span class=line><span class=cl>devtmpfs              16G     <span class=m>0</span>   16G   0% /dev
</span></span><span class=line><span class=cl>tmpfs                 16G   13M   16G   1% /dev/shm
</span></span><span class=line><span class=cl>tmpfs                 16G   26M   16G   1% /run
</span></span><span class=line><span class=cl>tmpfs                 16G     <span class=m>0</span>   16G   0% /sys/fs/cgroup
</span></span><span class=line><span class=cl>/dev/mapper/rl-root  913G   64G  849G   7% /
</span></span><span class=line><span class=cl>/dev/sda2           1014M  251M  764M  25% /boot
</span></span><span class=line><span class=cl>/dev/sda1            600M  6.0M  594M   1% /boot/efi
</span></span><span class=line><span class=cl>/dev/mapper/rl-home  9.6G  746M  8.9G   8% /home
</span></span><span class=line><span class=cl>tmpfs                3.2G   32K  3.2G   1% /run/user/1000
</span></span></code></pre></div></div><div class=post_footer></div></div><div class=doc_comments><div class=comments_block_title>发表评论</div><div id=comments></div></div><style>.giscus,.giscus-frame{margin-bottom:48px}</style><script src=https://giscus.app/client.js data-repo=QCute/qcute.github.io data-repo-id=R_kgDOG-5qXQ data-category=Announcements data-category-id=DIC_kwDOG-5qXc4CSRb_ data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=statistics><i class=ri-article-line></i>
<span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span>
</span><i class=ri-bar-chart-box-line></i>
<span id=busuanzi_container_site_pv><span id=busuanzi_value_site_pv></span></span></div><div class=footer_slogan><span>轻作 | 重拾写作的乐趣</span></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script><script src=/js/graphite.min.js></script><script src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script type=text/javascript id=MathJax-script async src=https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js></script><script>MathJax={options:{skipHtmlTags:["script","noscript","style","textarea","pre"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0}}</script></body></html>