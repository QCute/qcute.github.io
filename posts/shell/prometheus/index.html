<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="VarKai"><title>使用RPM仓库安装Prometheus ｜ 轻作</title>
<meta name=description content="1. 安装prometheus/grafana/alertmanager # rpm repo # https://github.com/lest/prometheus-rpm cat &amp;gt; /etc/yum.repos.d/prometheus.repo &amp;lt;&amp;lt; EOF [prometheus] name=prometheus baseurl=https://packagecloud.io/prometheus-rpm/release/el/\$releasever/\$basearch repo_gpgcheck=1 enabled=1 gpgkey=https://packagecloud.io/prometheus-rpm/release/gpgkey https://raw.githubusercontent.com/lest/prometheus-rpm/master/RPM-GPG-KEY-prometheus-rpm gpgcheck=1 metadata_expire=300 EOF # update cache dnf makecache # grafana dnf install grafana -y systemctl start grafana # prometheus dnf install prometheus -y # exporter cat &amp;gt;&amp;gt; /etc/prometheus/prometheus.yml &amp;lt;&amp;lt; EOF - job_name: &amp;#34;node_exporter&amp;#34; static_configs: - targets: [&amp;#34;localhost:9100&amp;#34;] - job_name: &amp;#34;mysqld_exporter&amp;#34; static_configs: - targets: [&amp;#34;localhost:9104&amp;#34;] - job_name: &amp;#34;process_exporter&amp;#34; static_configs: -"><meta name=keywords content="Hugo,theme,graphite"><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=apple-touch-icon type=image/x-icon href=/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.0.1/remixicon.css><link rel=stylesheet type=text/css media=screen href=/css/highlight.min.css><link rel=stylesheet type=text/css media=screen href=/css/graphite.min.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/tags/>标签</a></li><li><a href=/posts/>归档</a></li><li><a href=/about/>关于</a></li><li><a href=/search/ title=搜索 id=site_search><i class=ri-search-line></i></a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://qcute.github.io/><span><img src=/images/favicon.ico></span></a></h1></div><div class=description><h1 style=float:right><a><span>轻作</span></a></h1><br><br><p class=sub_title>重拾写作的乐趣</p><div class=my_socials><a href=https://github.com/QCute title=github target=_blank><i class=ri-github-fill></i></a>
<a href=https://www.zhihu.com/people/tui-fei-er-you-ya-de-shen-shi title=zhihu target=_blank><i class=ri-zhihu-fill></i></a>
<a href type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/shell/prometheus/>使用RPM仓库安装Prometheus</a></h2><span class=date>2020.03.10</span></div><div class="post_content markdown"><h3 id=1-安装prometheusgrafanaalertmanager>1. 安装prometheus/grafana/alertmanager</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># rpm repo</span>
</span></span><span class=line><span class=cl><span class=c1># https://github.com/lest/prometheus-rpm</span>
</span></span><span class=line><span class=cl>cat &gt; /etc/yum.repos.d/prometheus.repo <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>[prometheus]
</span></span></span><span class=line><span class=cl><span class=s>name=prometheus
</span></span></span><span class=line><span class=cl><span class=s>baseurl=https://packagecloud.io/prometheus-rpm/release/el/\$releasever/\$basearch
</span></span></span><span class=line><span class=cl><span class=s>repo_gpgcheck=1
</span></span></span><span class=line><span class=cl><span class=s>enabled=1
</span></span></span><span class=line><span class=cl><span class=s>gpgkey=https://packagecloud.io/prometheus-rpm/release/gpgkey
</span></span></span><span class=line><span class=cl><span class=s>       https://raw.githubusercontent.com/lest/prometheus-rpm/master/RPM-GPG-KEY-prometheus-rpm
</span></span></span><span class=line><span class=cl><span class=s>gpgcheck=1
</span></span></span><span class=line><span class=cl><span class=s>metadata_expire=300
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl><span class=c1># update cache</span>
</span></span><span class=line><span class=cl>dnf makecache
</span></span><span class=line><span class=cl><span class=c1># grafana</span>
</span></span><span class=line><span class=cl>dnf install grafana -y
</span></span><span class=line><span class=cl>systemctl start grafana
</span></span><span class=line><span class=cl><span class=c1># prometheus</span>
</span></span><span class=line><span class=cl>dnf install prometheus -y
</span></span><span class=line><span class=cl><span class=c1># exporter</span>
</span></span><span class=line><span class=cl>cat &gt;&gt; /etc/prometheus/prometheus.yml <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>  - job_name: &#34;node_exporter&#34;
</span></span></span><span class=line><span class=cl><span class=s>    static_configs:
</span></span></span><span class=line><span class=cl><span class=s>      - targets: [&#34;localhost:9100&#34;]
</span></span></span><span class=line><span class=cl><span class=s>  - job_name: &#34;mysqld_exporter&#34;
</span></span></span><span class=line><span class=cl><span class=s>    static_configs:
</span></span></span><span class=line><span class=cl><span class=s>      - targets: [&#34;localhost:9104&#34;]
</span></span></span><span class=line><span class=cl><span class=s>  - job_name: &#34;process_exporter&#34;
</span></span></span><span class=line><span class=cl><span class=s>    static_configs:
</span></span></span><span class=line><span class=cl><span class=s>      - targets: [&#34;localhost:9256&#34;]
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>systemctl start prometheus
</span></span><span class=line><span class=cl><span class=c1># alert manager</span>
</span></span><span class=line><span class=cl>dnf install alertmanager -y
</span></span><span class=line><span class=cl>systemctl start alertmanager
</span></span></code></pre></div><h3 id=2-安装node_exportermysqld_exporterprocess_exporter>2. 安装node_exporter/mysqld_exporter/process_exporter</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1>## node expoeter ##</span>
</span></span><span class=line><span class=cl>dnf install node_exporter -y
</span></span><span class=line><span class=cl><span class=c1># start</span>
</span></span><span class=line><span class=cl>systemctl start node_exporter
</span></span><span class=line><span class=cl><span class=c1>## mysql exporter ##</span>
</span></span><span class=line><span class=cl>dnf install mysqld_exporter -y
</span></span><span class=line><span class=cl><span class=c1># mysql ini config</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -n <span class=s1>&#39;MYSQLD_EXPORTER_OPTS=&#34;--config.my-cnf=/etc/prometheus/mysqld_exporter.ini&#34;&#39;</span> &gt; /etc/default/mysqld_exporter
</span></span><span class=line><span class=cl><span class=c1># mysql init config file</span>
</span></span><span class=line><span class=cl>cat &gt; /etc/prometheus/mysqld_exporter.ini <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>[client]
</span></span></span><span class=line><span class=cl><span class=s>host=localhost
</span></span></span><span class=line><span class=cl><span class=s>socket=/var/lib/mysql/mysql.sock
</span></span></span><span class=line><span class=cl><span class=s>port=3306
</span></span></span><span class=line><span class=cl><span class=s>user=root
</span></span></span><span class=line><span class=cl><span class=s>password=root
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl><span class=c1># start</span>
</span></span><span class=line><span class=cl>systemctl start mysqld_exporter
</span></span><span class=line><span class=cl><span class=c1>## process exporter ##</span>
</span></span><span class=line><span class=cl>dnf install process_exporter -y
</span></span><span class=line><span class=cl>systemctl start process_exporter
</span></span></code></pre></div></div><div class=post_footer></div></div><div class=doc_comments><div class=comments_block_title>发表评论</div><div id=comments></div></div><style>.giscus,.giscus-frame{margin-bottom:48px}</style><script src=https://giscus.app/client.js data-repo=QCute/qcute.github.io data-repo-id=R_kgDOG-5qXQ data-category=Announcements data-category-id=DIC_kwDOG-5qXc4CSRb_ data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>轻作、重拾写作的乐趣</span></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script><script src=/js/graphite.min.js></script><script type=text/javascript id=MathJax-script async src=https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js></script><script>MathJax={options:{skipHtmlTags:["script","noscript","style","textarea","pre"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0}}</script></body></html>