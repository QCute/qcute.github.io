<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="QCute"><title>微信小程序登录(wx.login)的 code 获取 ｜ 轻作</title>
<meta name=description content="闲来无事分析了一下, 微信版本是8.0.43
准备工具 jadx frida frida-node 微信日志hook代码 Java.perform(function () { const log = Java.use(&#34;com.tencent.mm.sdk.platformtools.Log&#34;); log.i.overload('java.lang.String', 'java.lang.String', '[Ljava.lang.Object;').implementation = function(tag: string, format: string, ...args: any) { console.info(tag, format, args); } log.w.overload('java.lang.String', 'java.lang.String', '[Ljava.lang.Object;').implementation = function(tag: string, format: string, ...args: any) { console.warn(tag, format, args); } log.e.overload('java.lang.String', 'java.lang.String', '[Ljava.lang.Object;').implementation = function(tag: string, format: string, ...args: any) { console.error(tag, format, args); } log.f.overload('java.lang.String', 'java.lang.String', '[Ljava.lang.Object;').implementation = function(tag: string, format: string, ...args: any) { console.debug(tag, format, args); } }); 核心日志 MicroMsg.JsApiLogin start login MicroMsg.JsApiLogin onSceneEnd errType = %d, errCode = %d ,errMsg = %s 0,0, MicroMsg.JsApiLogin stev NetSceneJSLogin jsErrcode %d 0 MicroMsg.JsApiLogin onSuccess ! MicroMsg.JsApiLogin resp data code [%s] 0e1U1KHa1Sp0qG0ripJa1QYvlB2U1KHm 可以看出, 最后一行得到的就是wx.login的code
在jadx搜索找到几个类
com.tencent.mm.plugin.appbrand.jsapi.auth.JsApiLogin.i com.tencent.mm.plugin.appbrand.jsapi.auth.JsApiLogin.g com.tencent.mm.plugin.appbrand.jsapi.auth.g0.a com.tencent.mm.plugin.appbrand.jsapi.auth.h0.a 在com.tencent.mm.plugin.appbrand.jsapi.auth.g0.a这个函数了, 找到最后一个参数的实体类a50.c, 并且找到字符串&#34;/cgi-bin/mmbiz-bin/js-login&#34;
"><meta name=keywords content="Hugo,theme,graphite"><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=apple-touch-icon type=image/x-icon href=/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.0.1/remixicon.css><link rel=stylesheet type=text/css media=screen href=/css/highlight.min.css><link rel=stylesheet type=text/css media=screen href=/css/graphite.min.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/tags/>标签</a></li><li><a href=/posts/>归档</a></li><li><a href=/about/>关于</a></li><li><a href=/search/ title=搜索 id=site_search><i class=ri-search-line></i></a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://qcute.github.io/><span><img src=/images/favicon.ico></span></a></h1></div><div class=description><h1 style=float:right><a><span>轻作</span></a></h1><br><br><p class=sub_title>重拾写作的乐趣</p><div class=my_socials><a href=https://github.com/QCute title=github target=_blank><i class=ri-github-fill></i></a>
<a href=https://www.zhihu.com/people/tui-fei-er-you-ya-de-shen-shi title=zhihu target=_blank><i class=ri-zhihu-fill></i></a>
<a href type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/android/wechat-appbrand-code/>微信小程序登录(wx.login)的 code 获取</a></h2><i class="icon ri-time-line"></i>
<span class=date>2020.03.03</span></div><div class="post_content markdown"><p>闲来无事分析了一下, 微信版本是8.0.43</p><h2 id=准备工具>准备工具</h2><ul><li><a href=https://github.com/skylot/jadx>jadx</a></li><li><a href=https://github.com/frida/frida>frida</a></li><li><a href=https://www.npmjs.com/package/frida>frida-node</a></li></ul><h2 id=微信日志hook代码>微信日志hook代码</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>Java</span><span class=p>.</span><span class=nx>perform</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>log</span> <span class=o>=</span> <span class=nx>Java</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s2>&#34;com.tencent.mm.sdk.platformtools.Log&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=p>.</span><span class=nx>i</span><span class=p>.</span><span class=nx>overload</span><span class=p>(</span><span class=s1>&#39;java.lang.String&#39;</span><span class=p>,</span> <span class=s1>&#39;java.lang.String&#39;</span><span class=p>,</span> <span class=s1>&#39;[Ljava.lang.Object;&#39;</span><span class=p>).</span><span class=nx>implementation</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>tag</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>format</span>: <span class=kt>string</span><span class=p>,</span> <span class=p>...</span><span class=nx>args</span>: <span class=kt>any</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=nx>tag</span><span class=p>,</span> <span class=nx>format</span><span class=p>,</span> <span class=nx>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=p>.</span><span class=nx>w</span><span class=p>.</span><span class=nx>overload</span><span class=p>(</span><span class=s1>&#39;java.lang.String&#39;</span><span class=p>,</span> <span class=s1>&#39;java.lang.String&#39;</span><span class=p>,</span> <span class=s1>&#39;[Ljava.lang.Object;&#39;</span><span class=p>).</span><span class=nx>implementation</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>tag</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>format</span>: <span class=kt>string</span><span class=p>,</span> <span class=p>...</span><span class=nx>args</span>: <span class=kt>any</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=nx>tag</span><span class=p>,</span> <span class=nx>format</span><span class=p>,</span> <span class=nx>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=p>.</span><span class=nx>e</span><span class=p>.</span><span class=nx>overload</span><span class=p>(</span><span class=s1>&#39;java.lang.String&#39;</span><span class=p>,</span> <span class=s1>&#39;java.lang.String&#39;</span><span class=p>,</span> <span class=s1>&#39;[Ljava.lang.Object;&#39;</span><span class=p>).</span><span class=nx>implementation</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>tag</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>format</span>: <span class=kt>string</span><span class=p>,</span> <span class=p>...</span><span class=nx>args</span>: <span class=kt>any</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>tag</span><span class=p>,</span> <span class=nx>format</span><span class=p>,</span> <span class=nx>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=p>.</span><span class=nx>f</span><span class=p>.</span><span class=nx>overload</span><span class=p>(</span><span class=s1>&#39;java.lang.String&#39;</span><span class=p>,</span> <span class=s1>&#39;java.lang.String&#39;</span><span class=p>,</span> <span class=s1>&#39;[Ljava.lang.Object;&#39;</span><span class=p>).</span><span class=nx>implementation</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>tag</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>format</span>: <span class=kt>string</span><span class=p>,</span> <span class=p>...</span><span class=nx>args</span>: <span class=kt>any</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=nx>tag</span><span class=p>,</span> <span class=nx>format</span><span class=p>,</span> <span class=nx>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h2 id=核心日志>核心日志</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>MicroMsg.JsApiLogin start login
</span></span><span class=line><span class=cl>MicroMsg.JsApiLogin onSceneEnd errType = %d, errCode = %d ,errMsg = %s 0,0,
</span></span><span class=line><span class=cl>MicroMsg.JsApiLogin stev NetSceneJSLogin jsErrcode %d 0
</span></span><span class=line><span class=cl>MicroMsg.JsApiLogin onSuccess !
</span></span><span class=line><span class=cl>MicroMsg.JsApiLogin resp data code [%s] 0e1U1KHa1Sp0qG0ripJa1QYvlB2U1KHm
</span></span></code></pre></div><p>可以看出, 最后一行得到的就是<a href=https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html>wx.login</a>的code</p><p>在<a href=https://github.com/skylot/jadx>jadx</a>搜索找到几个类</p><ul><li><a href>com.tencent.mm.plugin.appbrand.jsapi.auth.JsApiLogin.i</a></li><li><a href>com.tencent.mm.plugin.appbrand.jsapi.auth.JsApiLogin.g</a></li><li><a href>com.tencent.mm.plugin.appbrand.jsapi.auth.g0.a</a></li><li><a href>com.tencent.mm.plugin.appbrand.jsapi.auth.h0.a</a></li></ul><p>在<a href>com.tencent.mm.plugin.appbrand.jsapi.auth.g0.a</a>这个函数了, 找到最后一个参数的实体类<a href>a50.c</a>, 并且找到字符串<a href>"/cgi-bin/mmbiz-bin/js-login"</a></p><p>而在<a href>com.tencent.mm.plugin.appbrand.jsapi.auth.h0.a</a>这个函数, 找到最后一个参数的实体类<a href>a50.d</a>, 并且找到字符串<a href>"/cgi-bin/mmbiz-bin/js-login-confirm"</a>, 那就是说这是弹窗确认的API</p></div><div class=post_footer></div></div><div class=doc_comments><div class=comments_block_title>发表评论</div><div id=comments></div></div><style>.giscus,.giscus-frame{margin-bottom:48px}</style><script src=https://giscus.app/client.js data-repo=QCute/qcute.github.io data-repo-id=R_kgDOG-5qXQ data-category=Announcements data-category-id=DIC_kwDOG-5qXc4CSRb_ data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=statistics><i class=ri-article-line></i>
<span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span>
</span><i class=ri-bar-chart-box-line></i>
<span id=busuanzi_container_site_pv><span id=busuanzi_value_site_pv></span></span></div><div class=footer_slogan><span>轻作 | 重拾写作的乐趣</span></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script><script src=/js/graphite.min.js></script><script src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script type=text/javascript id=MathJax-script async src=https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js></script><script>MathJax={options:{skipHtmlTags:["script","noscript","style","textarea","pre"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0}}</script></body></html>