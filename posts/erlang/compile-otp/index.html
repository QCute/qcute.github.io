<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="VarKai"><title>编译Erlang虚拟机 ｜ 轻作</title><meta name=description content="环境为RHEL/CentOS/RockyLinux 8 1. 安装编译依赖 # 基础curses/ssl dnf install gcc make ncurses-devel openssl-devel -y # 可选hipe依赖 dnf install llvm autoconf m4 -y # 启用epel仓库 dnf install epel-release -y # 可选jdk/odbc/wxWidge"><meta name=keywords content="Hugo,theme,graphite"><link rel="shortcut icon" href=https://qcute.github.io/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/normalize.css@8.0.1/normalize.css><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/animate.css@4.1.1/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/remixicon@2.5.0/fonts/remixicon.css><link rel=stylesheet type=text/css media=screen href=https://unpkg.com/@fancyapps/ui@4.0.27/dist/fancybox.css><link rel=stylesheet type=text/css media=screen href=/css/highlight.min.css><link rel=stylesheet type=text/css media=screen href=/css/graphite.min.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/tags/>标签</a></li><li><a href=/posts/>归档</a></li><li><a href=/about/>关于</a></li><li><a href=/search/ title=搜索 id=site_search><i class=ri-search-line></i></a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://qcute.github.io/><span><img src=https://gohugo.io/favicon.ico></span></a></h1></div><div class=description><h1 style=float:right><a><span>轻作</span></a></h1><br><br><p class=sub_title>重拾写作的乐趣</p><div class=my_socials><a href=https://github.com/QCute title=github target=_blank><i class=ri-github-fill></i></a>
<a href=https://www.zhihu.com/people/tui-fei-er-you-ya-de-shen-shi title=zhihu target=_blank><i class=ri-zhihu-fill></i></a>
<a href=https://qcute.github.io/index.xml type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/erlang/compile-otp/>编译Erlang虚拟机</a></h2><span class=date>2022.03.08</span></div><div class="post_content markdown"><blockquote><p>环境为RHEL/CentOS/RockyLinux 8</p></blockquote><h3 id=1-安装编译依赖>1. 安装编译依赖</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 基础curses/ssl</span>
</span></span><span class=line><span class=cl>dnf install gcc make ncurses-devel openssl-devel -y
</span></span><span class=line><span class=cl><span class=c1># 可选hipe依赖</span>
</span></span><span class=line><span class=cl>dnf install llvm autoconf m4 -y
</span></span><span class=line><span class=cl><span class=c1># 启用epel仓库</span>
</span></span><span class=line><span class=cl>dnf install epel-release -y
</span></span><span class=line><span class=cl><span class=c1># 可选jdk/odbc/wxWidgets</span>
</span></span><span class=line><span class=cl>dnf install java-11-openjdk-devel unixODBC-devel libxslt-devel wxGTK3-devel gcc-c++ -y
</span></span><span class=line><span class=cl><span class=c1># 可选apache fop</span>
</span></span><span class=line><span class=cl><span class=nv>version</span><span class=o>=</span><span class=k>$(</span>curl -s http://archive.apache.org/dist/xmlgraphics/fop/binaries/ <span class=p>|</span> grep -Po <span class=s2>&#34;(?&lt;=fop-).*?(?=-bin\.zip)&#34;</span> <span class=p>|</span> sort -n <span class=p>|</span> tail -n 1<span class=k>)</span>
</span></span><span class=line><span class=cl>dnf install wget -y
</span></span><span class=line><span class=cl>wget http://archive.apache.org/dist/xmlgraphics/fop/binaries/fop-<span class=s2>&#34;</span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=s2>&#34;</span>-bin.tar.gz
</span></span><span class=line><span class=cl>tar -xf fop-<span class=s2>&#34;</span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=s2>&#34;</span>-bin.tar.gz -C /usr/local/
</span></span><span class=line><span class=cl>rm fop-<span class=s2>&#34;</span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=s2>&#34;</span>-bin.tar.gz
</span></span><span class=line><span class=cl>ln -s /usr/local/fop-<span class=s2>&#34;</span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=s2>&#34;</span>/fop/fop /usr/local/bin/fop
</span></span></code></pre></div><h3 id=2-配置>2. 配置</h3><p>OTP 24之前 (开启HIPE)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>./configure --enable-kernel-poll --enable-fips --enable-m64-build --enable-native-libs --enable-hipe
</span></span></code></pre></div><p>OTP 24之后 (开启JIT)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>./configure --enable-kernel-poll --enable-fips --enable-m64-build --enable-jit
</span></span></code></pre></div><h3 id=3-编译>3. 编译</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>make -j <span class=s2>&#34;</span><span class=k>$(</span>grep -c <span class=s2>&#34;processor&#34;</span> /proc/cpuinfo<span class=k>)</span><span class=s2>&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 可选strip, 减少二进制体积</span>
</span></span><span class=line><span class=cl>find ./bin/ -type f -exec file <span class=o>{}</span> <span class=se>\;</span> <span class=p>|</span> grep <span class=s2>&#34;not stripped&#34;</span> <span class=p>|</span> awk -F <span class=s2>&#34;:&#34;</span> <span class=s1>&#39;{print $1}&#39;</span> <span class=p>|</span> xargs -n <span class=m>1</span> strip
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 可选替换软链接绝对路径为相对路径</span>
</span></span><span class=line><span class=cl>sed -i <span class=s2>&#34;s/\&#34;s;%FINAL_ROOTDIR%;\$TARGET_ERL_ROOT;\&#34;/\&#34;s;%FINAL_ROOTDIR%;\\\\\$(dirname \\\\\$(dirname \\\\\$(readlink -f \\\\\$0)));\&#34;/&#34;</span> ./erts/etc/common/Install
</span></span></code></pre></div><h3 id=4-安装>4. 安装</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>make install
</span></span></code></pre></div></div><div class=post_footer></div></div><div class=doc_comments></div></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>轻作、重拾写作的乐趣</span></div></footer><script src=https://unpkg.com/elevator.js@1.0.1/elevator.min.js></script>
<script src=https://unpkg.com/dom-slider@2.1.6/dist/dom-slider.js></script>
<script src=https://unpkg.com/@fancyapps/ui@4.0.27/dist/fancybox.umd.js></script>
<script src=/js/graphite.min.js></script>
<script>MathJax={options:{skipHtmlTags:["script","noscript","style","textarea","pre"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0}}</script><script type=text/javascript id=MathJax-script async src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script></body></html>