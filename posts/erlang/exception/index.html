<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="VarKai"><title>Erlang异常性能 ｜ 轻作</title>
<meta name=description content="因为erlang没有提前返回, 所以需要提前返回, 异常是一个不错的想法, 但又怕有性能问题, 下面来测试下。 ts_exception() -&amp;gt; {LoopOnly, _} = timer:tc(?MODULE, loop_only, [1000000, none, undefined, undefined]), {LoopInTryCatchOnly, _} = timer:tc(?MODULE, loop_in_try_catch_only, [1000000, none, undefined]), {LoopInTryCatchStacktraceOnly, _} = timer:tc(?MODULE, loop_in_try_catch_stacktrace_only, [1000000, none, undefined, undefined]), {LoopInCatchOnly, _} = timer:tc(?MODULE, loop_in_catch_only, [1000000, none]), {TryCatchThrow, _} = timer:tc(?MODULE, loop_try_catch, [1000000, throw, undefined]), {TryCatchError, _} = timer:tc(?MODULE, loop_try_catch, [1000000,"><meta name=keywords content="Hugo,theme,graphite"><link rel=icon type=image/x-icon href=/images/favicon.ico><link rel=apple-touch-icon type=image/x-icon href=/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.0.1/remixicon.css><link rel=stylesheet type=text/css media=screen href=/css/highlight.min.css><link rel=stylesheet type=text/css media=screen href=/css/graphite.min.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/tags/>标签</a></li><li><a href=/posts/>归档</a></li><li><a href=/about/>关于</a></li><li><a href=/search/ title=搜索 id=site_search><i class=ri-search-line></i></a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://qcute.github.io/><span><img src=/images/favicon.ico></span></a></h1></div><div class=description><h1 style=float:right><a><span>轻作</span></a></h1><br><br><p class=sub_title>重拾写作的乐趣</p><div class=my_socials><a href=https://github.com/QCute title=github target=_blank><i class=ri-github-fill></i></a>
<a href=https://www.zhihu.com/people/tui-fei-er-you-ya-de-shen-shi title=zhihu target=_blank><i class=ri-zhihu-fill></i></a>
<a href type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/erlang/exception/>Erlang异常性能</a></h2><span class=date>2020.03.04</span></div><div class="post_content markdown"><p>因为erlang没有提前返回, 所以需要提前返回, 异常是一个不错的想法, 但又怕有性能问题, 下面来测试下。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-erl data-lang=erl><span class=line><span class=cl><span class=nf>ts_exception</span><span class=p>()</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>LoopOnly</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_only</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=n>none</span><span class=p>,</span> <span class=n>undefined</span><span class=p>,</span> <span class=n>undefined</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>LoopInTryCatchOnly</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_in_try_catch_only</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=n>none</span><span class=p>,</span> <span class=n>undefined</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>LoopInTryCatchStacktraceOnly</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_in_try_catch_stacktrace_only</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=n>none</span><span class=p>,</span> <span class=n>undefined</span><span class=p>,</span> <span class=n>undefined</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>LoopInCatchOnly</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_in_catch_only</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=n>none</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>TryCatchThrow</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_try_catch</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=n>throw</span><span class=p>,</span> <span class=n>undefined</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>TryCatchError</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_try_catch</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=n>error</span><span class=p>,</span> <span class=n>undefined</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>TryCatchExit</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_try_catch</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=nb>exit</span><span class=p>,</span> <span class=n>undefined</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>TryCatchStacktraceThrow</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_try_catch_stacktrace</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=n>throw</span><span class=p>,</span> <span class=n>undefined</span><span class=p>,</span> <span class=n>undefined</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>TryCatchStacktraceError</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_try_catch_stacktrace</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=n>error</span><span class=p>,</span> <span class=n>undefined</span><span class=p>,</span> <span class=n>undefined</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>TryCatchStacktraceExit</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_try_catch_stacktrace</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=nb>exit</span><span class=p>,</span> <span class=n>undefined</span><span class=p>,</span> <span class=n>undefined</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>CatchStacktraceThrow</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_catch</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=n>throw</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>CatchStacktraceError</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_catch</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=n>error</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nv>CatchStacktraceExit</span><span class=p>,</span> <span class=p>_}</span> <span class=o>=</span> <span class=nn>timer</span><span class=p>:</span><span class=nf>tc</span><span class=p>(</span><span class=o>?</span><span class=nv>MODULE</span><span class=p>,</span> <span class=n>loop_catch</span><span class=p>,</span> <span class=p>[</span><span class=mi>1000000</span><span class=p>,</span> <span class=nb>exit</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nn>io</span><span class=p>:</span><span class=nf>format</span><span class=p>(</span><span class=s>&#34;LoopOnly:~tp</span><span class=si>~n</span><span class=s>&#34;</span><span class=p>,</span> <span class=p>[</span><span class=nv>LoopOnly</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=nn>io</span><span class=p>:</span><span class=nf>format</span><span class=p>(</span><span class=s>&#34;LoopInTryCatchOnly:~tp</span><span class=si>~n</span><span class=s>&#34;</span><span class=p>,</span> <span class=p>[</span><span class=nv>LoopInTryCatchOnly</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=nn>io</span><span class=p>:</span><span class=nf>format</span><span class=p>(</span><span class=s>&#34;LoopInTryCatchStacktraceOnly:~tp</span><span class=si>~n</span><span class=s>&#34;</span><span class=p>,</span> <span class=p>[</span><span class=nv>LoopInTryCatchStacktraceOnly</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=nn>io</span><span class=p>:</span><span class=nf>format</span><span class=p>(</span><span class=s>&#34;LoopInCatchStacktraceOnly:~tp</span><span class=si>~n</span><span class=s>&#34;</span><span class=p>,</span> <span class=p>[</span><span class=nv>LoopInCatchOnly</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nn>io</span><span class=p>:</span><span class=nf>format</span><span class=p>(</span><span class=s>&#34;TryCatchThrow:~tp TryCatchError:~tp TryCatchExit:~tp</span><span class=si>~n</span><span class=s>&#34;</span><span class=p>,</span> <span class=p>[</span><span class=nv>TryCatchThrow</span><span class=p>,</span> <span class=nv>TryCatchError</span><span class=p>,</span> <span class=nv>TryCatchExit</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=nn>io</span><span class=p>:</span><span class=nf>format</span><span class=p>(</span><span class=s>&#34;TryCatchStacktraceThrow:~tp TryCatchStacktraceError:~tp TryCatchStacktraceExit:~tp</span><span class=si>~n</span><span class=s>&#34;</span><span class=p>,</span> <span class=p>[</span><span class=nv>TryCatchStacktraceThrow</span><span class=p>,</span> <span class=nv>TryCatchStacktraceError</span><span class=p>,</span> <span class=nv>TryCatchStacktraceExit</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=nn>io</span><span class=p>:</span><span class=nf>format</span><span class=p>(</span><span class=s>&#34;CatchStacktraceThrow:~tp CatchStacktraceError:~tp CatchStacktraceExit:~tp</span><span class=si>~n</span><span class=s>&#34;</span><span class=p>,</span> <span class=p>[</span><span class=nv>CatchStacktraceThrow</span><span class=p>,</span> <span class=nv>CatchStacktraceError</span><span class=p>,</span> <span class=nv>CatchStacktraceExit</span><span class=p>]).</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>loop_only</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>_,</span> <span class=p>_,</span> <span class=p>_)</span> <span class=o>-&gt;</span> <span class=n>ok</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nf>loop_only</span><span class=p>(</span><span class=nv>Times</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=nv>R</span><span class=p>,</span> <span class=nv>S</span><span class=p>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>make_an_exception</span><span class=p>(</span><span class=nv>Class</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>loop_only</span><span class=p>(</span><span class=nv>Times</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=nv>R</span><span class=p>,</span> <span class=nv>S</span><span class=p>).</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>loop_in_try_catch_only</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>_,</span> <span class=p>_)</span> <span class=o>-&gt;</span> <span class=n>ok</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nf>loop_in_try_catch_only</span><span class=p>(</span><span class=nv>Times</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=nv>R</span><span class=p>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span>
</span></span><span class=line><span class=cl>        <span class=n>make_an_exception</span><span class=p>(</span><span class=nv>Class</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>loop_in_try_catch_only</span><span class=p>(</span><span class=nv>Times</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=nv>R</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span>
</span></span><span class=line><span class=cl>        <span class=nv>Class</span><span class=p>:</span><span class=nv>Reason</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>loop_in_try_catch_only</span><span class=p>(</span><span class=nv>Times</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=nv>Reason</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span><span class=p>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>loop_in_try_catch_stacktrace_only</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>_,</span> <span class=p>_,</span> <span class=p>_)</span> <span class=o>-&gt;</span> <span class=n>ok</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nf>loop_in_try_catch_stacktrace_only</span><span class=p>(</span><span class=nv>Times</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=nv>R</span><span class=p>,</span> <span class=nv>S</span><span class=p>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span>
</span></span><span class=line><span class=cl>        <span class=n>make_an_exception</span><span class=p>(</span><span class=nv>Class</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>loop_in_try_catch_stacktrace_only</span><span class=p>(</span><span class=nv>Times</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=nv>R</span><span class=p>,</span> <span class=nv>S</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span>
</span></span><span class=line><span class=cl>        <span class=nv>Class</span><span class=p>:</span><span class=nv>Reason</span><span class=p>:</span><span class=nv>Stacktrace</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>loop_in_try_catch_stacktrace_only</span><span class=p>(</span><span class=nv>Times</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=nv>Reason</span><span class=p>,</span> <span class=nv>Stacktrace</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span><span class=p>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>loop_in_catch_only</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>_)</span> <span class=o>-&gt;</span> <span class=n>ok</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nf>loop_in_catch_only</span><span class=p>(</span><span class=nv>Times</span><span class=p>,</span> <span class=nv>Class</span><span class=p>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span> <span class=n>make_an_exception</span><span class=p>(</span><span class=nv>Class</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>loop_in_catch_only</span><span class=p>(</span><span class=nv>Times</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>Class</span><span class=p>).</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>loop_try_catch</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>_,</span> <span class=p>_)</span> <span class=o>-&gt;</span> <span class=n>ok</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nf>loop_try_catch</span><span class=p>(</span><span class=nv>Times</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=p>_)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span>
</span></span><span class=line><span class=cl>        <span class=n>make_an_exception</span><span class=p>(</span><span class=nv>Class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span>
</span></span><span class=line><span class=cl>        <span class=nv>Class</span><span class=p>:</span><span class=nv>Reason</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>loop_try_catch</span><span class=p>(</span><span class=nv>Times</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=nv>Reason</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span><span class=p>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>loop_try_catch_stacktrace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>_,</span> <span class=p>_,</span> <span class=p>_)</span> <span class=o>-&gt;</span> <span class=n>ok</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nf>loop_try_catch_stacktrace</span><span class=p>(</span><span class=nv>Times</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=p>_,</span> <span class=p>_)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span>
</span></span><span class=line><span class=cl>        <span class=n>make_an_exception</span><span class=p>(</span><span class=nv>Class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span>
</span></span><span class=line><span class=cl>        <span class=nv>Class</span><span class=p>:</span><span class=nv>Reason</span><span class=p>:</span><span class=nv>Stacktrace</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>loop_try_catch_stacktrace</span><span class=p>(</span><span class=nv>Times</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>Class</span><span class=p>,</span> <span class=nv>Reason</span><span class=p>,</span> <span class=nv>Stacktrace</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span><span class=p>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>loop_catch</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>_)</span> <span class=o>-&gt;</span> <span class=n>ok</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nf>loop_catch</span><span class=p>(</span><span class=nv>Times</span><span class=p>,</span> <span class=nv>Class</span><span class=p>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span> <span class=n>make_an_exception</span><span class=p>(</span><span class=nv>Class</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>loop_catch</span><span class=p>(</span><span class=nv>Times</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>Class</span><span class=p>).</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>make_an_exception</span><span class=p>(</span><span class=nv>Class</span><span class=p>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nv>Class</span> <span class=k>of</span>
</span></span><span class=line><span class=cl>        <span class=n>throw</span> <span class=o>-&gt;</span> <span class=nn>erlang</span><span class=p>:</span><span class=nf>throw</span><span class=p>(</span><span class=n>ladies</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>error</span> <span class=o>-&gt;</span> <span class=nn>erlang</span><span class=p>:</span><span class=nf>error</span><span class=p>(</span><span class=n>ladies</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nb>exit</span> <span class=o>-&gt;</span> <span class=nn>erlang</span><span class=p>:</span><span class=nb>exit</span><span class=p>(</span><span class=n>ladies</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>_</span> <span class=o>-&gt;</span> <span class=n>nothing_wrong</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span><span class=p>.</span>
</span></span></code></pre></div><h3 id=时间>时间</h3><h2 id=不带stacktrace>不带stacktrace</h2><table><thead><tr><th>Loop</th><th>Time</th></tr></thead><tbody><tr><td>None</td><td>6161</td></tr><tr><td>TryCatch</td><td>130163</td></tr><tr><td>TryCatchStacktrace</td><td>31760</td></tr><tr><td>CatchStacktrace</td><td>6142</td></tr></tbody></table><h2 id=携带stacktrace>携带stacktrace</h2><table><thead><tr><th>Exception</th><th>Throw</th><th>Error</th><th>Exit</th></tr></thead><tbody><tr><td>TryCatch</td><td>76689</td><td>73875</td><td>73508</td></tr><tr><td>TryCatchStacktrace</td><td>555028</td><td>557794</td><td>547894</td></tr><tr><td>CatchStacktrace</td><td>72909</td><td>73629</td><td>72771</td></tr></tbody></table><h3 id=结论>结论</h3><p>在不发生异常的情况下</p><ul><li>频繁进入try/catch性能很差。</li><li>直接catch性能反而没什么损失。</li></ul><p>在发生异常的情况下</p><ul><li>异常比正常返回慢了十几倍。</li><li>带stacktrace的try/catch性能是最差的, 比其他两种方法相差近8倍。</li></ul><p>所以, 异常能不用就不用, 哪怕在<a href>JIT</a>预热后还是挺慢的。</p></div><div class=post_footer></div></div><div class=doc_comments><div class=comments_block_title>发表评论</div><div id=comments></div></div><style>.giscus,.giscus-frame{margin-bottom:48px}</style><script src=https://giscus.app/client.js data-repo=QCute/qcute.github.io data-repo-id=R_kgDOG-5qXQ data-category=Announcements data-category-id=DIC_kwDOG-5qXc4CSRb_ data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>轻作、重拾写作的乐趣</span></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script><script src=/js/graphite.min.js></script><script type=text/javascript id=MathJax-script async src=https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js></script><script>MathJax={options:{skipHtmlTags:["script","noscript","style","textarea","pre"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0}}</script></body></html>